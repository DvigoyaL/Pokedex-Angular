import{d as G}from"./chunk-ASY6I5VR.js";import{a as J,b as R,c as Y}from"./chunk-6IK65MMJ.js";import{a as z,b as H}from"./chunk-MGRCBOLI.js";import"./chunk-PPITJ3XK.js";import{Ca as O,I as b,Oa as p,Pa as v,Ra as B,S as C,Sa as U,Sb as j,Ta as L,Ua as r,Va as a,Wa as T,X as g,Y as u,Z as I,_ as A,_a as P,a as V,ab as F,b as M,cb as l,kb as m,l as x,lb as $,nb as N,ta as s,v as h,x as E}from"./chunk-LOYXRZLP.js";var K=(i,o)=>o.id;function Q(i,o){if(i&1){let e=P();r(0,"button",11),F("click",function(){g(e);let n=l();return u(n.clearAllFavorites())}),m(1," Clear All "),a()}}function W(i,o){i&1&&(r(0,"div",6),T(1,"div",12),r(2,"p",13),m(3,"Loading your favorites..."),a()())}function X(i,o){if(i&1&&(r(0,"div",7)(1,"p",14),m(2),a()()),i&2){let e=l();s(2),$(e.error)}}function Z(i,o){i&1&&(r(0,"div",8),I(),r(1,"svg",15),T(2,"path",16),a(),A(),r(3,"h3",17),m(4,"No favorites yet"),a(),r(5,"p",18),m(6,"Start adding Pok\xE9mon to your favorites from the List page"),a(),r(7,"a",19),m(8," Go to List "),a()())}function ee(i,o){if(i&1){let e=P();r(0,"pokedex-pokemon-basic-card",21),F("cardClicked",function(n){g(e);let d=l(2);return u(d.selectPokemon(n))})("favoriteToggled",function(n){g(e);let d=l(2);return u(d.onFavoriteToggled(n))}),a()}if(i&2){let e=o.$implicit,t=l(2);L("pokemon",e)("backgroundColor",t.getColorForType(e.types[0].type.name))("showFavoriteButton",!0)("isFavorite",!0)}}function te(i,o){if(i&1&&(r(0,"ul",9),B(1,ee,1,4,"pokedex-pokemon-basic-card",20,K),a()),i&2){let e=l();s(),U(e.favoritePokemonList)}}function oe(i,o){if(i&1){let e=P();r(0,"pokedex-pokemon-modal-card",22),F("modalClosed",function(){g(e);let n=l();return u(n.closeModal())})("pokemonSelected",function(n){g(e);let d=l();return u(d.selectPokemon(n))}),a()}if(i&2){let e=l();L("pokemon",e.selectedPokemon)("pokemonList",e.favoritePokemonList)}}var D=class i{pokemonService=C(z);favoritesService=C(J);pokemonUtils=C(H);favoritePokemonList=[];selectedPokemon=null;isLoading=!1;error=null;ngOnInit(){this.loadFavorites(),this.favoritesService.favorites$.subscribe(()=>{this.loadFavorites()})}loadFavorites(){let o=this.favoritesService.getFavorites();if(o.length===0){this.favoritePokemonList=[];return}this.isLoading=!0,this.error=null;let e=o.map(t=>this.getFullPokemonDetails(`https://pokeapi.co/api/v2/pokemon/${t.id}/`));h(e).pipe(E(t=>(console.error("Failed to load favorite Pok\xE9mon",t),this.error="Failed to load some Pok\xE9mon. Please try again.",x([])))).subscribe(t=>{this.favoritePokemonList=t.filter(n=>n!==null),this.isLoading=!1})}getFullPokemonDetails(o){return this.pokemonService.getPokemonDetails(o).pipe(b(e=>this.pokemonService.getPokemonSpecies(e.species.url).pipe(b(t=>{let n=e.types.map(f=>this.pokemonService.getTypeDetails(f.type.url)),d=this.pokemonService.getEvolutionChain(t.evolution_chain.url);return h({typeDetails:h(n),evolutionChain:d}).pipe(b(({typeDetails:f,evolutionChain:k})=>{let w=t.flavor_text_entries.find(c=>c.language.name==="en")?.flavor_text.replace(/[\n\f]/g," ")||"No description.",y=new Set,S=new Set;f.forEach(c=>{c.damage_relations.double_damage_from.forEach(_=>y.add(_.name)),c.damage_relations.half_damage_from.forEach(_=>S.add(_.name)),c.damage_relations.no_damage_from.forEach(_=>S.add(_.name))}),S.forEach(c=>y.delete(c));let q=this.flattenEvolutionChain(k.chain);return x(M(V({},e),{habitat:t.habitat?.name||"unknown",description:w,weaknesses:Array.from(y),evolutionChain:q}))}))}))),E(e=>(console.error(`Failed to load details for ${o}`,e),x(null))))}flattenEvolutionChain(o){let e=[],t=o;for(;t;){let n=t.species.url.split("/"),d=n[n.length-2];e.push({name:t.species.name,id:d}),t.evolves_to.length>1?(t.evolves_to.forEach(f=>{let k=f.species.url.split("/"),w=k[k.length-2];e.push({name:f.species.name,id:w})}),t=void 0):t=t.evolves_to[0]}return e}selectPokemon(o){"name"in o&&(this.selectedPokemon=o)}closeModal(){this.selectedPokemon=null}getColorForType(o){return this.pokemonUtils.getColorForType(o)}onFavoriteToggled(o){let e={id:o.id,name:o.name,imageUrl:o.sprites.other?.["official-artwork"]?.front_default||o.sprites.front_default};this.favoritesService.toggleFavorite(e)}isFavorite(o){return this.favoritesService.isFavorite(o)}clearAllFavorites(){confirm("Are you sure you want to remove all favorites?")&&this.favoritesService.clearAllFavorites()}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=O({type:i,selectors:[["pokedex-favorites-page"]],decls:14,vars:8,consts:[[1,"min-h-screen","py-8","lg:pt-24",2,"background","linear-gradient(135deg, #fffbe6 0%, #ffe082 100%)"],[1,"container","mx-auto","px-4","max-w-7xl"],[1,"flex","items-center","justify-between","mb-8"],[1,"text-4xl","font-bold","mb-2",2,"color","#fbc02d"],[1,"text-gray-700","text-lg"],[1,"px-4","py-2","bg-red-500","text-white","rounded-lg","font-semibold","hover:bg-red-600","transition","shadow-md"],[1,"text-center","my-20"],[1,"bg-red-100","border","border-red-400","text-red-700","px-4","py-3","rounded-lg","mb-6"],[1,"text-center","py-20"],[1,"grid","grid-cols-3","sm:grid-cols-4","md:grid-cols-7","gap-4"],[3,"pokemon","pokemonList"],[1,"px-4","py-2","bg-red-500","text-white","rounded-lg","font-semibold","hover:bg-red-600","transition","shadow-md",3,"click"],[1,"animate-spin","rounded-full","h-16","w-16","border-b-4","mb-4","mx-auto",2,"border-color","#fbc02d"],[1,"text-xl","text-gray-700"],[1,"font-medium"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-24","w-24","mx-auto","mb-4","text-gray-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"],[1,"text-2xl","font-bold","text-gray-700","mb-2"],[1,"text-gray-600","mb-6"],["routerLink","/list-page",1,"inline-block","px-6","py-3","text-white","rounded-lg","font-semibold","hover:opacity-90","transition","shadow-md",2,"background-color","#fbc02d"],[3,"pokemon","backgroundColor","showFavoriteButton","isFavorite"],[3,"cardClicked","favoriteToggled","pokemon","backgroundColor","showFavoriteButton","isFavorite"],[3,"modalClosed","pokemonSelected","pokemon","pokemonList"]],template:function(e,t){e&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"div")(4,"h1",3),m(5," Favs "),a(),r(6,"p",4),m(7),a()(),p(8,Q,2,0,"button",5),a(),p(9,W,4,0,"div",6),p(10,X,3,1,"div",7),p(11,Z,9,0,"div",8),p(12,te,3,0,"ul",9),a()(),p(13,oe,1,2,"pokedex-pokemon-modal-card",10)),e&2&&(s(7),N(" You have ",t.favoritesService.count," favorite",t.favoritesService.count!==1?"s":""," "),s(),v(t.favoritesService.count>0?8:-1),s(),v(t.isLoading?9:-1),s(),v(t.error?10:-1),s(),v(!t.isLoading&&t.favoritePokemonList.length===0?11:-1),s(),v(!t.isLoading&&t.favoritePokemonList.length>0?12:-1),s(),v(t.selectedPokemon?13:-1))},dependencies:[j,G,R,Y],encapsulation:2})};export{D as default};
