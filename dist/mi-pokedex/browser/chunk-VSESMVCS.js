import{a as A}from"./chunk-W4DQ4XLV.js";import{a as ee}from"./chunk-KTRI4THZ.js";import{a as j,b as J,c as Y}from"./chunk-6IK65MMJ.js";import{a as U,b as $}from"./chunk-MGRCBOLI.js";import"./chunk-PPITJ3XK.js";import{Ca as O,Ha as K,I as T,Oa as u,Pa as h,Ra as M,S as v,Sa as V,Sb as B,Ta as x,Ua as s,Va as a,Wa as W,X as d,Y as p,_a as w,a as F,ab as P,b as E,cb as l,kb as g,l as C,lb as I,mb as X,nb as Z,p as R,ta as c,tb as N,v as S,x as D}from"./chunk-LOYXRZLP.js";var ie=()=>[],ne=(i,o)=>o.id;function re(i,o){i&1&&(s(0,"div",1),W(1,"div",5),s(2,"span",6),g(3,"Searching Pok\xE9mon..."),a()())}function se(i,o){if(i&1&&(s(0,"div",2)(1,"div",7),g(2,"Oops!"),a(),s(3,"p",8),g(4),a()()),i&2){let e=l();c(4),I(e.error)}}function ae(i,o){if(i&1&&(s(0,"div",2)(1,"div",9),g(2,"No results"),a(),s(3,"p",10),g(4),a()()),i&2){let e=l();c(4),X('No Pok\xE9mon found matching "',e.currentSearchTerm,'"')}}function le(i,o){if(i&1){let e=w();s(0,"pokedex-pokemon-basic-card",15),P("cardClicked",function(){let r=d(e).$implicit,n=l(2);return p(n.selectPokemon(r))})("favoriteToggled",function(r){d(e);let n=l(2);return p(n.onFavoriteToggled(r))}),a()}if(i&2){let e=o.$implicit,t=l(2);x("pokemon",e)("backgroundColor",t.getColorForType(e.types[0].type.name))("showFavoriteButton",!0)("isFavorite",t.isFavorite(e.id))}}function ce(i,o){if(i&1&&(s(0,"div",11),M(1,le,1,4,"pokedex-pokemon-basic-card",12,ne),a(),s(3,"div",13)(4,"p",14),g(5),a()()),i&2){let e=l();c(),V(e.searchResults),c(4),Z(" Showing ",e.searchResults.length,' result(s) for "',e.currentSearchTerm,'" ')}}function me(i,o){i&1&&(s(0,"div",3)(1,"div",16),g(2,"\u{1F50D}"),a(),s(3,"p",17),g(4,"Type in the search bar to find Pok\xE9mon"),a()())}function de(i,o){if(i&1){let e=w();s(0,"pokedex-pokemon-modal-card",18),P("modalClosed",function(){d(e);let r=l();return p(r.closeModal())})("pokemonSelected",function(r){d(e);let n=l();return p(n.selectPokemon(r))}),a()}if(i&2){let e=l();x("pokemon",e.selectedPokemon)("pokemonList",N(2,ie))}}var q=class i{pokemonService=v(U);searchService=v(A);pokemonUtils=v($);favoritesService=v(j);allPokemonList=[];limit=21;searchResultsChange=new K;pokemonSelected=new K;searchResults=[];isLoading=!1;error=null;selectedPokemon=null;currentSearchTerm="";searchSubscription;ngOnInit(){this.subscribeToSearch()}ngOnDestroy(){this.searchSubscription?.unsubscribe()}subscribeToSearch(){this.searchSubscription=this.searchService.searchTerm$.subscribe(o=>{this.currentSearchTerm=o,this.performSearch(o)})}performSearch(o){let e=o.toLowerCase();if(!o){this.clearResults();return}this.isLoading=!0,this.error=null;let t=this.allPokemonList.filter(n=>n.name.toLowerCase().includes(e)).slice(0,this.limit);if(t.length===0){this.searchResults=[],this.isLoading=!1,this.error=`No Pok\xE9mon found matching "${o}".`,this.emitResults();return}let r=t.map(n=>this.getFullPokemonDetails(n.url));S(r).subscribe(n=>{this.searchResults=n.filter(_=>_!==null),this.isLoading=!1,this.error=null,this.emitResults()})}clearResults(){this.searchResults=[],this.isLoading=!1,this.error=null,this.emitResults()}emitResults(){let o={pokemon:this.searchResults,isLoading:this.isLoading,error:this.error,hasResults:this.searchResults.length>0};this.searchResultsChange.emit(o)}getFullPokemonDetails(o){return this.pokemonService.getPokemonDetails(o).pipe(T(e=>{let t=this.pokemonService.getPokemonSpecies(e.species.url),r=e.types.map(n=>this.pokemonService.getTypeDetails(n.type.url));return t.pipe(T(n=>{let _=this.pokemonService.getEvolutionChain(n.evolution_chain.url);return S({species:C(n),typeDetails:S(r),evolutionChain:_}).pipe(R(({species:k,typeDetails:b,evolutionChain:z})=>{let G=k.flavor_text_entries.find(m=>m.language.name==="en")?.flavor_text.replace(/[\n\f]/g," ")||"No description.",L=new Set,y=new Set;b.forEach(m=>{m.damage_relations.double_damage_from.forEach(f=>L.add(f.name)),m.damage_relations.half_damage_from.forEach(f=>y.add(f.name)),m.damage_relations.no_damage_from.forEach(f=>y.add(f.name))}),y.forEach(m=>L.delete(m));let H=this.flattenEvolutionChain(z.chain);return E(F({},e),{habitat:k.habitat?.name||"unknown",description:G,weaknesses:Array.from(L),evolutionChain:H})}))}))}),D(e=>(console.error(`Failed to load details for ${o}`,e),C(null))))}flattenEvolutionChain(o){let e=[],t=o;for(;t;){let r=t.species.url.split("/"),n=r[r.length-2];e.push({name:t.species.name,id:n}),t.evolves_to.length>1?(t.evolves_to.forEach(_=>{let k=_.species.url.split("/"),b=k[k.length-2];e.push({name:_.species.name,id:b})}),t=void 0):t=t.evolves_to[0]}return e}selectPokemon(o){this.isLoading=!0;let e=`https://pokeapi.co/api/v2/pokemon/${o.id}/`;this.getFullPokemonDetails(e).pipe(D(t=>(console.error("Failed to load selected Pok\xE9mon details",t),this.error="Could not load the details of this Pok\xE9mon.",this.closeModal(),C(null)))).subscribe(t=>{t&&(this.selectedPokemon=t,this.pokemonSelected.emit(t)),this.isLoading=!1})}closeModal(){this.selectedPokemon=null}getColorForType(o){return this.pokemonUtils.getColorForType(o)}onFavoriteToggled(o){let e={id:o.id,name:o.name,imageUrl:o.sprites.other?.["official-artwork"]?.front_default||o.sprites.front_default};this.favoritesService.toggleFavorite(e)}isFavorite(o){return this.favoritesService.isFavorite(o)}clearSearch(){this.searchService.updateSearchTerm("")}isSearching(){return this.currentSearchTerm.length>0}getSearchTerm(){return this.currentSearchTerm}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=O({type:i,selectors:[["app-search-results"]],inputs:{allPokemonList:"allPokemonList",limit:"limit"},outputs:{searchResultsChange:"searchResultsChange",pokemonSelected:"pokemonSelected"},decls:7,vars:6,consts:[[1,"search-results-container"],[1,"flex","justify-center","items-center","py-8"],[1,"text-center","py-8"],[1,"text-center","py-12"],[3,"pokemon","pokemonList"],[1,"animate-spin","rounded-full","h-12","w-12","border-b-2","border-yellow-500"],[1,"ml-3","text-gray-600"],[1,"text-red-500","text-lg","font-semibold","mb-2"],[1,"text-gray-600"],[1,"text-gray-500","text-lg","font-semibold","mb-2"],[1,"text-gray-400"],[1,"grid","grid-cols-1","sm:grid-cols-2","md:grid-cols-3","lg:grid-cols-4","xl:grid-cols-5","gap-4"],[3,"pokemon","backgroundColor","showFavoriteButton","isFavorite"],[1,"mt-6","text-center"],[1,"text-sm","text-gray-500"],[3,"cardClicked","favoriteToggled","pokemon","backgroundColor","showFavoriteButton","isFavorite"],[1,"text-gray-400","text-lg","mb-2"],[1,"text-gray-500"],[3,"modalClosed","pokemonSelected","pokemon","pokemonList"]],template:function(e,t){e&1&&(s(0,"div",0),u(1,re,4,0,"div",1),u(2,se,5,1,"div",2),u(3,ae,5,1,"div",2),u(4,ce,6,2),u(5,me,5,0,"div",3),a(),u(6,de,1,3,"pokedex-pokemon-modal-card",4)),e&2&&(c(),h(t.isLoading?1:-1),c(),h(t.error&&!t.isLoading?2:-1),c(),h(!t.isLoading&&!t.error&&t.currentSearchTerm&&t.searchResults.length===0?3:-1),c(),h(t.searchResults.length>0&&!t.isLoading?4:-1),c(),h(!t.currentSearchTerm&&!t.isLoading?5:-1),c(),h(t.selectedPokemon?6:-1))},dependencies:[B,J,Y],styles:[".search-results-container[_ngcontent-%COMP%]{min-height:400px;padding:1rem}.animate-spin[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.text-center[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center}@media (max-width: 640px){.search-results-container[_ngcontent-%COMP%]{padding:.5rem}}app-pokemon-basic-card[_ngcontent-%COMP%]{transition:transform .2s ease-in-out}app-pokemon-basic-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px)}"]})};var pe=()=>[],ue=(i,o)=>o.id;function he(i,o){i&1&&(s(0,"div",0)(1,"p",3),g(2,"Loading Pok\xE9mon..."),a()())}function ge(i,o){if(i&1&&(s(0,"div",0)(1,"p",4),g(2),a()()),i&2){let e=l();c(2),I(e.error)}}function _e(i,o){if(i&1){let e=w();s(0,"app-search-results",5),P("searchResultsChange",function(r){d(e);let n=l();return p(n.onSearchResultsChange(r))})("pokemonSelected",function(r){d(e);let n=l();return p(n.onSearchPokemonSelected(r))}),a()}if(i&2){let e=l();x("allPokemonList",e.allPokemonList)("limit",e.limit)}}function ke(i,o){if(i&1){let e=w();s(0,"pokedex-pokemon-basic-card",9),P("cardClicked",function(){let r=d(e).$implicit,n=l(2);return p(n.selectPokemon(r))})("favoriteToggled",function(r){d(e);let n=l(2);return p(n.onFavoriteToggled(r))}),a()}if(i&2){let e=o.$implicit,t=l(2);x("pokemon",e)("backgroundColor",t.getColorForType(e.types[0].type.name))("showFavoriteButton",!0)("isFavorite",t.isFavorite(e.id))}}function fe(i,o){if(i&1){let e=w();s(0,"ul",6),M(1,ke,1,4,"pokedex-pokemon-basic-card",7,ue),a(),s(3,"pokedex-pokemon-navigationButtons",8),P("previousClicked",function(){d(e);let r=l();return p(r.onPreviousPage())})("nextClicked",function(){d(e);let r=l();return p(r.onNextPage())}),a()}if(i&2){let e=l();c(),V(e.pokemonList),c(2),x("offset",e.offset)("isLoading",e.isLoading)}}var Q=class i{pokemonService=v(U);searchService=v(A);pokemonUtils=v($);favoritesService=v(j);pokemonList=[];allPokemonList=[];selectedPokemon=null;offset=0;limit=21;isLoading=!1;error=null;isSearching=!1;ngOnInit(){this.loadAllPokemonNames(),this.loadPokemon(),this.subscribeToSearchState()}loadPokemon(){this.isLoading=!0,this.error=null,this.pokemonService.getListPokemon(this.offset,this.limit).pipe(T(o=>{if(!o.results||o.results.length===0)return C([]);let e=o.results.map(t=>this.getFullPokemonDetails(t.url));return S(e)}),D(o=>(console.error("Failed to load Pok\xE9mon list",o),this.error="Could not load Pok\xE9mon. Please try again later.",C([])))).subscribe(o=>{this.pokemonList=o,this.isLoading=!1})}loadAllPokemonNames(){this.pokemonService.getListPokemon(0,1500).subscribe(o=>{this.allPokemonList=o.results})}subscribeToSearchState(){this.searchService.searchTerm$.subscribe(o=>{this.isSearching=o.length>0})}onSearchResultsChange(o){}onSearchPokemonSelected(o){this.selectedPokemon=o}selectPokemon(o){this.isLoading=!0;let e=`https://pokeapi.co/api/v2/pokemon/${o.id}/`;this.getFullPokemonDetails(e).pipe(D(t=>(console.error("Failed to load selected Pok\xE9mon details",t),this.error="Could not load the details of this Pok\xE9mon.",this.closeModal(),C(null)))).subscribe(t=>{t&&(this.selectedPokemon=t),this.isLoading=!1})}getFullPokemonDetails(o){return this.pokemonService.getPokemonDetails(o).pipe(T(e=>{let t=this.pokemonService.getPokemonSpecies(e.species.url),r=e.types.map(n=>this.pokemonService.getTypeDetails(n.type.url));return t.pipe(T(n=>{let _=this.pokemonService.getEvolutionChain(n.evolution_chain.url);return S({species:C(n),typeDetails:S(r),evolutionChain:_}).pipe(R(({species:k,typeDetails:b,evolutionChain:z})=>{let G=k.flavor_text_entries.find(m=>m.language.name==="en")?.flavor_text.replace(/[\n\f]/g," ")||"No description.",L=new Set,y=new Set;b.forEach(m=>{m.damage_relations.double_damage_from.forEach(f=>L.add(f.name)),m.damage_relations.half_damage_from.forEach(f=>y.add(f.name)),m.damage_relations.no_damage_from.forEach(f=>y.add(f.name))}),y.forEach(m=>L.delete(m));let H=this.flattenEvolutionChain(z.chain);return E(F({},e),{habitat:k.habitat?.name||"Desconocido",description:G,weaknesses:Array.from(L),evolutionChain:H})}))}))}))}flattenEvolutionChain(o){let e=[],t=o;for(;t;){let r=t.species.url.split("/"),n=r[r.length-2];e.push({name:t.species.name,id:n}),t.evolves_to.length>1?(t.evolves_to.forEach(_=>{let k=_.species.url.split("/"),b=k[k.length-2];e.push({name:_.species.name,id:b})}),t=void 0):t=t.evolves_to[0]}return e}closeModal(){this.selectedPokemon=null}onPreviousPage(){this.offset>0&&(this.offset-=this.limit,this.loadPokemon())}onNextPage(){this.offset+=this.limit,this.loadPokemon()}getColorForType(o){return this.pokemonUtils.getColorForType(o)}onFavoriteToggled(o){let e={id:o.id,name:o.name,imageUrl:o.sprites.other?.["official-artwork"]?.front_default||o.sprites.front_default};this.favoritesService.toggleFavorite(e)}isFavorite(o){return this.favoritesService.isFavorite(o)}ngOnDestroy(){}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=O({type:i,selectors:[["pokedex-list-page"]],decls:5,vars:7,consts:[[1,"text-center","my-8"],[3,"allPokemonList","limit"],[3,"modalClosed","pokemonSelected","pokemon","pokemonList"],[1,"text-xl","text-gray-600"],[1,"text-red-500","text-xl"],[3,"searchResultsChange","pokemonSelected","allPokemonList","limit"],[1,"grid","grid-cols-3","sm:grid-cols-4","md:grid-cols-7","gap-4","p-8"],[3,"pokemon","backgroundColor","showFavoriteButton","isFavorite"],[3,"previousClicked","nextClicked","offset","isLoading"],[3,"cardClicked","favoriteToggled","pokemon","backgroundColor","showFavoriteButton","isFavorite"]],template:function(e,t){e&1&&(u(0,he,3,0,"div",0),u(1,ge,3,1,"div",0),u(2,_e,1,2,"app-search-results",1),u(3,fe,4,2),s(4,"pokedex-pokemon-modal-card",2),P("modalClosed",function(){return t.closeModal()})("pokemonSelected",function(n){return t.selectPokemon(n)}),a()),e&2&&(h(t.isLoading&&!t.isSearching?0:-1),c(),h(t.error&&!t.isSearching?1:-1),c(),h(t.isSearching?2:-1),c(),h(!t.isLoading&&!t.error&&!t.isSearching?3:-1),c(),x("pokemon",t.selectedPokemon)("pokemonList",t.isSearching?N(6,pe):t.pokemonList))},dependencies:[B,J,ee,Y,q],styles:["[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px}[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#ffffff1a;border-radius:10px}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:#0003;border-radius:10px;border:2px solid transparent;background-clip:content-box}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background-color:#0006}"]})};export{Q as default};
