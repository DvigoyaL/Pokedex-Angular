<div class="min-h-screen">
  <!-- Mobile Filter Toggle Button (visible only on mobile) -->
  <button
    (click)="toggleFilterPanel()"
    class="fixed bottom-6 right-6 z-40 lg:hidden bg-yellow-400 text-white p-4 rounded-full shadow-lg hover:bg-yellow-500 transition"
    style="background-color: #fbc02d;"
  >
    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z" />
    </svg>
  </button>

  <!-- Overlay (mobile only) -->
  @if (isFilterPanelOpen) {
    <div
      class="fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden"
      (click)="closeFilterPanel()"
    ></div>
  }

  <!-- Sidebar with Filters -->
  <aside
    [class.translate-x-0]="isFilterPanelOpen"
    [class.-translate-x-full]="!isFilterPanelOpen"
    class="fixed top-0 lg:top-16 left-0 w-80 bg-white border-r border-gray-200 overflow-y-auto h-screen lg:h-[calc(100vh-4rem)] z-50 lg:z-10 transition-transform duration-300 lg:translate-x-0"
  >
    <!-- Close button (mobile only) -->
    <button
      (click)="closeFilterPanel()"
      class="absolute top-4 right-4 lg:hidden text-gray-600 hover:text-gray-800 z-10"
    >
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>

    <app-filter-panel
      [firstFilterType]="filterStateData.firstFilter.type"
      (filterChange)="onFilterChange($event)"
    ></app-filter-panel>
  </aside>

  <!-- Main Content -->
  <main class="lg:ml-80 lg:pt-16 flex-1">
    <!-- Estado IDLE - Sin filtros aplicados -->
    @if (filterStateData.state === 'IDLE') {
      <app-filter-empty-state />
    }

    <!-- Loading State -->
    @if (isLoading) {
      <app-filter-loading-state
        [isLoadingUnknownHabitat]="filterStateData.firstFilter.type === 'habitat' && filterStateData.firstFilter.value === 'unknown'"
      />
    }

    <!-- Error Message -->
    @if (error) {
      <app-filter-error-message [errorMessage]="error" />
    }

    <!-- Results -->
    @if (filterStateData.state === 'PRIMARY_LOADED' && !isLoading) {
      @if (displayedPokemonList.length > 0) {
        <app-filter-results
          [displayedPokemon]="displayedPokemonList"
          [totalResults]="totalResults"
          [firstFilter]="filterStateData.firstFilter"
          [additionalFilters]="{
            types: filterStateData.additionalPrimaryFilters.types,
            generations: filterStateData.additionalPrimaryFilters.generations,
            habitats: filterStateData.additionalPrimaryFilters.habitats
          }"
          [currentPage]="currentPage"
          [itemsPerPage]="itemsPerPage"
          [isLoading]="isLoading"
          [favoriteIds]="favoriteIds"
          (pokemonSelected)="selectPokemon($event)"
          (favoriteToggled)="onFavoriteToggled($event)"
          (previousPageClicked)="onPreviousPage()"
          (nextPageClicked)="onNextPage()"
        />
      } @else {
        <app-filter-no-results />
      }
    }
  </main>
</div>

<!-- Modal for Pokemon Details -->
@if (selectedPokemon) {
  <pokedex-pokemon-modal-card
    [pokemon]="selectedPokemon"
    [pokemonList]="displayedPokemonList"
    (modalClosed)="closeModal()"
    (pokemonSelected)="selectPokemon($event)"
  />
}

